version: '3'
services:
  website:
    image: advent-website
    container_name: advent-website
    ports:
      - "80:80"
      - "443:443"
    restart: always
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt
      - /home/ubuntu/logs/website:/srv/logs
  day01:
    image: day01
    container_name: day01
    ports:
      - "1:1"
      - "11111:11111"
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "curl -H \"Cookie2: XMAS=supersecretstuffhere\" localhost:11111 | grep -q \"Here we go\" || exit 1"]
      interval: 1m30s
      timeout: 10s
      retries: 3
  day02:
    image: day02
    container_name: day02
    ports:
      - "2:4444/udp"
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "echo \"Q\" | openssl s_client -dtls1_2 -connect localhost:4444 2>/dev/null | grep -q \"Secret:\" || exit 1"]
      interval: 1m30s
      timeout: 10s
      retries: 3
    tty: true
  day03:
    image: day03
    container_name: day03
    ports:
      - "3:80"
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "wget http://localhost:80/elf -O /tmp/elf || exit 1"]
      interval: 1m30s
      timeout: 10s
      retries: 3
  day04:
    image: day04
    container_name: day04
    ports:
      - "4:9000"
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "/proxy.sh socks5 localhost 9000 curl --socks5 localhost:9000 localhost:9000/flag.txt | grep -q JAHr7BBNh0fp3IlbC2DItfWOV0CYIj3J || exit 1"]
      interval: 1m30s
      timeout: 10s
      retries: 3
  day10:
    image: day10
    container_name: day10
    ports:
      - "10:80"
    restart: always
